<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scanner – Volume vs MarketCap</title>

  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" />

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      padding: 20px;
      zoom: 90%;
    }
    table {
      width: 100%;
      background: white;
    }
    .status, .contagem {
      font-weight: bold;
      margin-bottom: 15px;
    }
    textarea {
      width: 100%;
      height: 80px;
      margin-top: 10px;
      font-size: 14px;
      padding: 10px;
    }
    h2 {
      margin-top: 0;
    }
  </style>
</head>
<body>
  <script>
  const url = 'https://script.google.com/macros/s/AKfycbyEqRe8R__N4kLrXqYi_QWS1ROaQULNngDxV41h2_wFIJx8_u0sES1Xx5pIX3s-ByDtNQ/exec';

  // 🔁 Recuperar anotações do navegador
  window.onload = function () {
    const campo = document.querySelector("textarea");
    campo.value = localStorage.getItem("anotacoes") || "";
    campo.addEventListener("input", () => {
      localStorage.setItem("anotacoes", campo.value);
    });
  };

  fetch(url)
    .then(res => res.json())
    .then(data => {
      if (!data || data.length === 0) {
        document.querySelector(".status").textContent = "Nenhum dado encontrado.";
        return;
      }

      const headers = Object.keys(data[0]);
      const thead = document.querySelector("#painel thead tr");
      headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        thead.appendChild(th);
      });

      const tbody = document.querySelector("#painel tbody");
      data.forEach(row => {
        const tr = document.createElement("tr");
        headers.forEach(h => {
          const td = document.createElement("td");
          let valor = row[h];

          if (h === "🔗" && typeof valor === "string") {
            td.innerHTML = `<a href="${valor}" target="_blank">🔗</a>`;
          } else if (h === "↕️") {
            td.textContent = valor;
            if (valor === "📈") td.style.color = "green";
            else if (valor === "📉") td.style.color = "red";
            else td.style.color = "gray";
          } else if (!isNaN(valor)) {
            td.style.textAlign = "right";
            td.textContent = valor;
          } else {
            td.textContent = valor;
          }

          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

      document.querySelector("#painel").style.display = "table";
      document.querySelector(".status").style.display = "none";
      document.querySelector(".contagem").textContent = `🔢 Total de moedas carregadas: ${data.length}`;

      new DataTable('#painel', {
        responsive: true,
        paging: false, // ✅ sem paginação
        dom: 'Bfrtip',
        buttons: ['csv', 'excel'],
        order: [[5, 'desc']]
      });
    })
    .catch(err => {
      document.querySelector(".status").textContent = "❌ Erro ao carregar dados.";
      console.error(err);
    });
  </script>
